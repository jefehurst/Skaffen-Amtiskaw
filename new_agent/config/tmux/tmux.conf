# =============================================================================
# SoS tmux.conf - Demo-ready, accessibility-focused configuration
#
# Theme: Kanagawa Wave (WCAG-compliant, high contrast for weak eyes)
# Usage: Loaded automatically by start.sh when launching tmux
# =============================================================================

# -----------------------------------------------------------------------------
# Kanagawa Wave Color Palette Reference
# https://github.com/rebelot/kanagawa.nvim
#
# Background:     #1f1f28 (BG), #2a2a37 (BG_LIGHT), #363646 (BG_LIGHTER)
# Foreground:     #dcd7ba (FG), #727169 (FG_DIM)
# Accents:        #98bb6c (Spring Green), #d27e99 (Sakura Pink)
#                 #7e9cd8 (Wave Blue), #ffa066 (Surimi Orange)
#                 #7fb4ca (Crystal Blue), #c8c093 (Old White)
# -----------------------------------------------------------------------------

# -----------------------------------------------------------------------------
# General Settings
# -----------------------------------------------------------------------------
# Modern terminal support
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",xterm-256color:Tc"
set -ga terminal-overrides ",*256col*:Tc"

# Enable mouse (useful for demos and pane resizing)
set -g mouse on

# Start windows and panes at 1, not 0 (easier to reach)
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Generous scrollback history
set -g history-limit 50000

# No delay for escape key (important for vim users)
set -sg escape-time 0

# Increase repeat time for repeatable commands
set -g repeat-time 300

# Focus events for vim/neovim
set -g focus-events on

# -----------------------------------------------------------------------------
# Clipboard Integration (OSC 52 - works through SSH/tmux)
# -----------------------------------------------------------------------------
set -g set-clipboard on

# -----------------------------------------------------------------------------
# Status Bar - Clean, readable, demo-friendly
# -----------------------------------------------------------------------------
set -g status on
set -g status-position bottom
set -g status-interval 5

# Status bar colors (BG_LIGHT background, FG foreground)
set -g status-style "bg=#2a2a37,fg=#dcd7ba"

# Left: Session name (Wave Blue background)
set -g status-left-length 30
set -g status-left "#[bg=#7e9cd8,fg=#1f1f28,bold] #S #[bg=#2a2a37,fg=#7e9cd8]"

# Right: Git branch + Date/Time (large, readable)
set -g status-right-length 80
set -g status-right "#[fg=#727169] #(cd #{pane_current_path}; git branch --show-current 2>/dev/null || echo '-') #[fg=#98bb6c]#{?#{!=:#(cd #{pane_current_path}; git status --porcelain 2>/dev/null | head -1),},+,} #[fg=#363646]|#[fg=#c8c093] %d %b #[fg=#dcd7ba,bold]%H:%M "

# Window list - left aligned
set -g status-justify left

# Window status (inactive) - dimmed with status indicator
# Status chars: ○ idle, ! alert/ready
setw -g window-status-style "fg=#727169"
setw -g window-status-format " #I:#W #{?window_activity_flag,!,#{?window_bell_flag,!,○}} "

# Window status (active) - Wave Blue background indicates focus
# Style set separately so hooks can override it
setw -g window-status-current-style "bg=#7e9cd8,fg=#1f1f28,bold"
setw -g window-status-current-format " #I:#W ● "

# Window separator
setw -g window-status-separator ""

# -----------------------------------------------------------------------------
# Window Ready Notification (via Claude Code Stop hook)
# -----------------------------------------------------------------------------
# Built-in monitoring disabled (doesn't work for our use case).
# Instead, scripts/notify-ready.sh sets window style directly.
# This hook resets style when user switches to the window.

setw -g monitor-activity off
setw -g monitor-silence 0
setw -g monitor-bell off
set -g visual-activity off
set -g visual-silence off
set -g visual-bell off
set -g bell-action none
set -g activity-action none
set -g silence-action none

# Reset window style when it becomes active (clears the "ready" highlight)
set-hook -g window-pane-changed 'set-window-option window-status-style default'
set-hook -g client-session-changed 'set-window-option window-status-style default'

# -----------------------------------------------------------------------------
# Pane Borders - High contrast for visibility
# -----------------------------------------------------------------------------
# Inactive: subtle gray
set -g pane-border-style "fg=#363646"

# Active: Spring Green (high visibility)
set -g pane-active-border-style "fg=#98bb6c"

# Pane border status (off for cleaner look)
set -g pane-border-status off

# -----------------------------------------------------------------------------
# Messages and Command Prompt
# -----------------------------------------------------------------------------
# Messages: Wave Blue background
set -g message-style "bg=#7e9cd8,fg=#1f1f28,bold"
set -g message-command-style "bg=#d27e99,fg=#1f1f28,bold"

# -----------------------------------------------------------------------------
# Window/Pane Selection Menu
# -----------------------------------------------------------------------------
set -g mode-style "bg=#7e9cd8,fg=#1f1f28"

# -----------------------------------------------------------------------------
# Key Bindings
# -----------------------------------------------------------------------------
# Keep C-b as prefix (standard, muscle memory)

# Reload config (try project config first, fall back to user config)
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded"
bind R source-file ~/.tmux.conf \; display-message "User config reloaded"

# Intuitive splits (in current directory)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind '\' split-window -h -c "#{pane_current_path}"
bind _ split-window -v -c "#{pane_current_path}"

# Vim-style pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Vim-style pane resizing (with repeat)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Quick window navigation
bind -r C-h previous-window
bind -r C-l next-window

# New window in current directory
bind c new-window -c "#{pane_current_path}"

# Kill pane without confirmation
bind x kill-pane

# Synchronize panes toggle
bind S setw synchronize-panes \; display-message "Sync #{?synchronize-panes,ON,OFF}"

# Clear scrollback buffer
bind C-k clear-history \; display-message "Scrollback cleared"

# -----------------------------------------------------------------------------
# Copy Mode (vi-style)
# -----------------------------------------------------------------------------
setw -g mode-keys vi

# Enter copy mode
bind v copy-mode

# Vi-style selection in copy mode
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi Escape send-keys -X cancel

# Rectangle selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle

# -----------------------------------------------------------------------------
# Window Titles
# -----------------------------------------------------------------------------
set -g set-titles on
set -g set-titles-string "#S / #W"

# Disable automatic window renaming (prevents process names from overriding titles)
setw -g automatic-rename off
